# 2.3.2.1 MSA \(Mirco Service Architecture\) 소개

MSA \(Micro Service Architecture\)는 기존 서비스의 모든 기능이 하나의 애플리케이션에서 구현되었던 Monolithic Architecture 구조에서 벗어나 독립적으로 배포/확장할 수 있는 작은 서비스 단위로 쪼개고 조합하여 대규모 애플리케이션을 구성하는 아키텍처 패턴입니다.

## Monolithic Architecture

MSA 아키텍처를 소개하기 전에 그 동안 Monolithic Architecture 기반에서 애플리케이션이 어떻게 개발/배포 되었는지 살펴볼 필요가 있습니다.

![](https://github.com/istiokrsg/istio_book_kr/tree/db537f7d53525991029377f8bdba34de236e0a89/.gitbook/assets/image-1.png)

Monolithic Architecture 는 소프트웨어의 모든 구성요소가 하나의 애플리케이션 또는 프로젝트에 통합되어 있는 형태입니다. 쇼핑몰 웹 서비스를 예를 들면, 서비스를 위한 여러가지 기능을 다음과 같이 생각해 볼 수 있습니다.

**\[쇼핑몰 웹서비스\]**

* 사용자 가입/탈퇴
* 사용자 인증
* 로그인
* 물건조회
* 쇼핑카트
* 결제
* 게시판

이 밖에 더 많은 다양한 기능들이 쇼핑몰 웹 서비스를 위해 필요합니다. 프로젝트의 목적과 기능 구현 범위를 산정하여 몇몇의 개발자로 구성된 소규모 프로젝트일 경우 유지보수 측면에서 Monolithic Architecture 가 더 유리할 수 있습니다. 하지만 프로젝트가 점점 확장되고, 서비스 해야 할 모듈들이 늘어나고, 이를 개발하기 위한 개발자들의 참여가 많아진다면 이 모든 것을 하나의 애플리케이션 내에서 개발하는 것은 다음과 같은 여러가지 한계에 부딪힙니다.

* 프로젝트 크기가 커지고, 각 서비스 모듈이 늘어나면서 전체 서비스 구조 파악이 어렵습니다.
* 일부 서비스 모듈의 변경사항 때문에 전체 애플리케이션 개발/운영 프로세스와 패키징에 영향을 줍니다.
* 전체 서비스를 빌드/배포하는데 시간이 기하급수적으로 늘어납니다.
* 서비스 모듈 단위로 Scale-out 이 어렵습니다.
* 일부 서비스 모듈의 장애가 전체 서비스 장애로 이어집니다.

서비스의 비지니스의 TTM \(Time to Market\) 전략에 따라 각 서비스 모듈별로 민첩하게 기능이 추가/개발되어야 할 필요성이 점점 늘어나고 있습니다. 서비스가 거대해지고 복잡할 수록 장기적으로 안정적인 운영을 위해 MSA 아키텍처의 필요성은 더욱 중요합니다.

## MSA Architecture

MSA 아키텍처는 기존 Monolithic 구조에서의 통합된 기능들을 독립적으로 분리하여 확장/배포할 수 있도록 쪼개고, Containerization 하고, 이를 지속적으로 코드 통합/빌드/배포 할 수 있는 아키텍처로 확장해 나가야 합니다.

[Martin Folwer](https://martinfowler.com/articles/microservices.html) 가 정의한 MSA 아키텍처의 개념은 다음과 같습니다.

> MSA 아키텍처 스타일은 자신의 프로세스로써 스스로 돌아갈 수 있는 간단한 메커니즘, 예를 들면 HTTP API와 통신하는 소규모 서비스 단위로서 단일 애플리케이션을 개발하는 접근 방식 입니다. 이러한 서비스는 비지니스 기능을 중심으로 구축되며 완전히 자동화된 배포 프로세스를 통해 독립적으로 배포할 수 있습니다.

위 구문에서 MSA의 핵심은 **"작은 서비스 단위로서 스스로 돌아갈 수 있는 서비스"** 와 **"독립적인 배포"** 2가지 입니다. 이 문구를 아래 그림이 잘 설명해주고 있습니다.

![](https://github.com/istiokrsg/istio_book_kr/tree/db537f7d53525991029377f8bdba34de236e0a89/.gitbook/assets/image-6.png)

### MSA 특징

* 각각의 서비스는 책임이 명확한 작은 서비스 모듈 단위로 분리하고, 이를 조합한 솔루션 형태로 제공한다.
* 각각의 서비스 모듈은 완전히 상호 독립적으로 배포 가능해야 하고, 다른 여러 서비스에서 재사용 가능해야 한다.
* 각 서비스는 개별 서비스로 실행되고, API 통신 \(HTTP, JSON\) 같은 경량 통신 프로토콜을 사용이 가능해야 한다.
* 각 서비스 다양한 언어와 기술로 개발할 수 있고, 서비스 간 의존성은 최소화 되어야 한다.

최근 container 기술이 발전하면서 각 서비스 모듈을 container 단위로 쪼개고, 쿠버네티스 또는 Public/Private Cloud 환경에서 오케스트레이션 할 수 있는 다양한 플랫폼들이 제공되고 있습니다. MSA 아키텍처 개념이 등장한지도 오래 되었고, 그 중요성에 대해서도 모두 공감하지만 이를 실제 서비스 환경에 적용하기 위해서는 다음과 같은 MSA 장/담점을 고려해야 합니다.

#### MSA 장점

* 작은 서비스 단위로 나누고, 독립적으로 실행 가능한 환경을 만듦으로써 loosely coupled 가능하다.
* TTM\(Time To Market\) 전략에 따른 서비스 추가 확장/개발이 가능하고, 서비스 중단 없는 개별 배포가 가능하다.
* 특정 서비스에 부하에 대한 Scaling \(container replica count 증가\)이 가능하다.
* 서비스 모듈을 다른 프로젝트에서 재사용 가능하다.
* 서비스 별 개발자의 선호에 따른 OS, 프로그래밍 언어 제한을 받지 않는다.
* CI/CD \(코드의 지속적인 통합/배포\)가 서비스 모듈 단위로 소수의 인원의 책임하에 이루어질 수 있다.
* 각 서비스에서 발생한 장애가 전체 서비스의 장애로 이루어지지 않기 때문에 Fault Isolation 특성이 좋다.

#### MSA 단점

* 너무 많은 단위의 서비스 모듈로 쪼갤 경우, 각 서비스 간 모니터링, 장애 추적이 어렵다.
* 여러 서비스에 동시 제공하는 Feature의 경우, 트랜잭션을 다루기 어렵고, 테스트하기 힘들다.
* 서비스 간 의존성이 있는 경우 릴리즈가 까다롭다.
* 서비스 간 API 호출 과정에서 통신 비용이 증가할 수 있고, Latency 증가에 따른 성능 저하가 발생할 수 있다.
* 서비스 개수가 많고, 유동적이기 때문에 CI/CD 관리가 많아지고, 관리상 문제가 발생할 소지가 많다.
* 기존 Monolithic 아키텍처에서 MSA 아키텍처 마이그레이션 하는 과정에는 고통이 따른다.

