---
layout: splash
title: 2. Kubernetes & Istio ì„¤ì¹˜ ë° ì‹œì‘í•´ë³´ê¸° (2.1 Kubernetes ì„¤ì¹˜ ê°€ì´ë“œ))
date: 2019-03-03 08:26:28 -0400
categories: istio
tags: [istio, install]
---

### 2.1.3 Minikube ë¹ ë¥¸ ì‹œì‘
ì§€ê¸ˆê¹Œì§€ Minikube ì£¼ìš” ê¸°ëŠ¥ê³¼ ì„¤ì¹˜ ê°€ì´ë“œë¥¼ í†µí•´ í…ŒìŠ¤íŠ¸/ê°œë°œ í•˜ê¸° ìœ„í•œ í™˜ê²½êµ¬ì¶• ë°©ë²•ì— ëŒ€í•´ ì†Œê°œí–ˆìŠµë‹ˆë‹¤. ì§€ê¸ˆë¶€í„°ëŠ” Minikube ì—ì„œ ì œê³µí•˜ëŠ” ë‹¤ì–‘í•œ ê¸°ëŠ¥ê³¼ kubectl CLI ë„êµ¬ë¥¼ ì´ìš©í•˜ì—¬ Minikube í´ëŸ¬ìŠ¤í„°ë¥¼ ì œì–´í•˜ê¸° ìœ„í•œ ë°©ë²•ì— ëŒ€í•´ ì†Œê°œí•˜ê² ìŠµë‹ˆë‹¤.

#### Minikube ì‹¤í–‰
Minikube ì‹¤í–‰ì—¬ë¶€ë¥¼ í™•ì¸í•˜ê³ , Running ìƒíƒœê°€ ì•„ë‹ˆë¼ë©´ minikube start ëª…ë ¹ì„ í†µí•´ ì‹¤í–‰í•©ë‹ˆë‹¤.
Minikube ì‹¤í–‰ ê²°ê³¼ë¥¼ ë³´ë©´ OSX(darwin) í™˜ê²½ì—ì„œ ì‹¤í–‰ë˜ê³ , Docker Engine(18.09.6) ìœ„ì— Kubernetes v1.14.3 ê°€ ì •ìƒ ì‹¤í–‰ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- Minikube ìƒíƒœ í™•ì¸
```
$ minikube status
host: Stopped
kubelet:
apiserver:
kubectl:
```

- Minikube ì‹¤í–‰

```
$ minikube start

ğŸ˜„  minikube v1.1.1 on darwin (amd64)
âš ï¸  Ignoring --vm-driver=virtualbox, as the existing "minikube" VM was created using the hyperkit driver.
âš ï¸  To switch drivers, you may create a new VM using `minikube start -p <name> --vm-driver=virtualbox`
âš ï¸  Alternatively, you may delete the existing VM using `minikube delete -p minikube`

ğŸ”„  Restarting existing hyperkit VM for "minikube" ...
âŒ›  Waiting for SSH access ...
ğŸ³  Configuring environment for Kubernetes v1.14.3 on Docker 18.09.6
ğŸ”„  Relaunching Kubernetes v1.14.3 using kubeadm ...
```

#### Kubernetes ë””í”Œë¡œì´ë¨¼íŠ¸ ìƒì„±
kubectlì„ ì´ìš©í•˜ì—¬ echoserver ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í•˜ì—¬ Kubernetes Deploymentë¥¼ ìƒì„±í•©ë‹ˆë‹¤. ì„œë¹„ìŠ¤ ë””í”Œë¡œì´ë¨¼íŠ¸ ì´ë¦„ì€ hello-minikube ìœ¼ë¡œ ì„¤ì •í•˜ì˜€ê³ , --port ì˜µì…˜ì„ ì‚¬ìš©í•˜ì—¬ 8080 í¬íŠ¸ë²ˆí˜¸ë¡œ ì™¸ë¶€ì— ë…¸ì¶œí•©ë‹ˆë‹¤.

```
$ kubectl run hello-minikube --image=k8s.gcr.io/echoserver:1.10 --port=8080
kubectl run --generator=deployment/apps.v1 is DEPRECATED and will be removed in a future version. Use kubectl run --generator=run-pod/v1 or kubectl create instead.
deployment.apps/hello-minikube created
```

#### ì„œë¹„ìŠ¤ ë…¸ì¶œ
hello-minikube ë””í”Œë¡œì´ë¨¼íŠ¸ì— ì—‘ì„¸ìŠ¤í•˜ê¸° ìœ„í•´ expose ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ ì„œë¹„ìŠ¤ë¡œ ë…¸ì¶œí•©ë‹ˆë‹¤.
ì™¸ë¶€ ì„œë¹„ìŠ¤ë¡œ ë…¸ì¶œí•˜ê¸° ìœ„í•´ --type=NodePort íƒ€ì…ì„ ì§€ì •í•©ë‹ˆë‹¤.
```
$ kubectl expose deployment hello-minikube --type=NodePort
service/hello-minikube exposed
```

#### ì„œë¹„ìŠ¤ êµ¬ë™ í™•ì¸
hello-minikube Podê°€ ì‹¤í–‰ë˜ê³  ìˆëŠ” ì¤‘ì´ê³ , Podê°€ ì •ìƒì ìœ¼ë¡œ ì‹¤í–‰ë˜ì–´ êµ¬ë™ì¤‘ì¸ì§€ í™•ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.
ì•„ë˜ì™€ ê°™ì´ hello-minikybe Pod 2ê°œê°€ 12ë¶„ ì „ì— ì‹¤í–‰ë˜ì—ˆê³ , ëª¨ë‘ ì‹¤í–‰ì¤‘ì¸ ìƒíƒœë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. STTUS=ContainerCreating ìƒíƒœë¡œ ë³´ì¼ ê²½ìš°, ì•„ì§ Podê°€ ìƒì„±ì¤‘ì„ì„ ë‚˜íƒ€ë‚´ëŠ” ê²ƒì´ê³  ì ì‹œ í›„ì— Running ìƒíƒœë¡œ ë³€í•˜ê²Œ ë©ë‹ˆë‹¤.
```
$ kubectl get pod
NAME                              READY   STATUS    RESTARTS   AGE
hello-minikube-56cdb79778-64ffl   2/2     Running   0          12m
```

#### ì„œë¹„ìŠ¤ ìƒì„¸ì •ë³´ í™•ì¸
hello-minikube ì„œë¹„ìŠ¤ì— ì ‘ì†í•˜ê¸° ìœ„í•œ url ì •ë³´ë¥¼ ì–»ìŠµë‹ˆë‹¤.
Node IP(192.168.64.2)ì™€ ë…¸ì¶œëœ ì™¸ë¶€ ì„œë¹„ìŠ¤ í¬íŠ¸(31546)ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ë¸Œë¼ìš°ì €ë¥¼ ë„ìš´í›„ http://192.168.64.2:31546 URLë¡œ ì ‘ì†í•˜ë©´ echoserver ì„œë²„ë¡œë¶€í„° ë°›ì€
ì‘ë‹µë©”ì‹œë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```
$ minikube service hello-minikube --url
http://192.168.64.2:31546
```

ì•„ë˜ì™€ ê°™ì´ echoserverë¡œë¶€í„° ë°›ì€ ì‘ë‹µë©”ì‹œë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```
Hostname: hello-minikube-56cdb79778-64ffl

Pod Information:
	-no pod information available-

Server values:
	server_version=nginx: 1.13.3 - lua: 10008

Request Information:
	client_address=127.0.0.1
	method=GET
	real path=/
	query=
	request_version=1.1
	request_scheme=http
	request_uri=http://192.168.64.2:8080/

Request Headers:
	accept=text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3
	accept-encoding=gzip, deflate
	accept-language=ko-KR,ko;q=0.9,en-US;q=0.8,en;q=0.7
	connection=keep-alive
	dnt=1
	host=192.168.64.2:31546
	upgrade-insecure-requests=1
	user-agent=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3770.100 Safari/537.36

Request Body:
	-no body in request-
```

hello-minikube ì„œë¹„ìŠ¤ì— ëŒ€í•œ ìì„¸í•œ ì •ë³´ëŠ” minikube dashboard ê¸°ëŠ¥ì„ í†µí•´ì„œë„ í™•ì¸ ê°€ëŠ¥í•©ë‹ˆë‹¤.
ì•„ë˜ì™€ ê°™ì´ ëŒ€ì‹œë³´ë“œë¥¼ ì‹¤í–‰í•œ í›„, ì™¼ìª½ ë©”ë‰´ì—ì„œ ì›Œí¬ë¡œë“œ->íŒŒë“œ(Pod)ë¥¼ í´ë¦­í•˜ë©´ ë°©ê¸ˆ ì‹¤í–‰í•œ hello-minikube-56cdb79778-64ffl ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. Podë¥¼ í´ë¦­í•˜ë©´ ì•„ë˜ ê·¸ë¦¼ê³¼ ê°™ì´ ìƒì„¸í•œ ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- kubernetes ëŒ€ì‹œë³´ë“œ ì‹¤í–‰
```
$ minikube dashboard
```

- kubernetes ëŒ€ì‹œë³´ë“œë¥¼ ì´ìš©í•œ Pod ìƒì„¸ì •ë³´ í™•ì¸

![pod-detail-info](./images/install-guide/pod-detail-info.png)

- echoserver ìš”ì²­ë©”ì‹œì§€ ê²½ë¡œë¶„ì„
ë¸Œë¼ìš°ì €ì—ì„œ URL(http://192.168.64.2:31546/)ì„ í†µí•´ echoserver ê¹Œì§€ ë©”ì‹œì§€ê°€ ì „ë‹¬ë˜ëŠ” ê²½ë¡œë¥¼ ë¶„ì„í•´ë³´ë©´ ì•„ë˜ ê·¸ë¦¼ì²˜ëŸ¼ ë„ì‹í™” í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
![echoserver-node-port](./images/install-guide/echoserver-nodeport-archi.png)
