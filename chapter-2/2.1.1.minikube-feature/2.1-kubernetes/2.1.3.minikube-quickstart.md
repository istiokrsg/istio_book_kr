---
layout: splash
title: 2. Kubernetes & Istio ì„¤ì¹˜ ë° ì‹œì‘í•´ë³´ê¸° (2.1 Kubernetes ì„¤ì¹˜ ê°€ì´ë“œ))
date: '2019-03-03 08:26:28 -0400'
categories: istio
tags:
  - istio
  - install
---

# 2.1.3 Minikube ë¹ ë¥¸ ì‹œì‘

ì§€ê¸ˆê¹Œì§€ Minikube ì£¼ìš” ê¸°ëŠ¥ì„ í™•ì¸í•˜ê³  ì„¤ì¹˜ ê°€ì´ë“œë¥¼ í†µí•´ Kubernetes í´ëŸ¬ìŠ¤í„°ë¥¼ êµ¬ì¶•í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ì†Œê°œí–ˆìŠµë‹ˆë‹¤. ì§€ê¸ˆë¶€í„°ëŠ” Minikube ì—ì„œ ì œê³µí•˜ëŠ” ë‹¤ì–‘í•œ ê¸°ëŠ¥ê³¼ kubectl CLI ë„êµ¬ë¥¼ ì´ìš©í•˜ì—¬ Minikube í´ëŸ¬ìŠ¤í„°ë¥¼ ì œì–´í•˜ê¸° ìœ„í•œ ë°©ë²•ì— ëŒ€í•´ ì†Œê°œí•˜ê² ìŠµë‹ˆë‹¤.

## Minikube ì‹¤í–‰

Minikube ì‹¤í–‰ì—¬ë¶€ë¥¼ í™•ì¸í•˜ê³ , Running ìƒíƒœê°€ ì•„ë‹ˆë¼ë©´ minikube start ëª…ë ¹ì„ í†µí•´ ì‹¤í–‰í•©ë‹ˆë‹¤. Minikube ì‹¤í–‰ ê²°ê³¼ë¥¼ ë³´ë©´ OSX\(darwin\) í™˜ê²½ì—ì„œ ì‹¤í–‰ë˜ê³ , Docker Engine\(18.09.6\) ìœ„ì— Kubernetes v1.14.3 ê°€ ì •ìƒ ì‹¤í–‰ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### Minikube ìƒíƒœ í™•ì¸

```text
minikube status

host: Stopped
kubelet:
apiserver:
kubeconfig:
```

### Minikube ì‹¤í–‰

```text
minikube start --vm-driver=virtualbox

ğŸ˜„  minikube v1.5.2 on Darwin 10.14.5
ğŸ’¡  Tip: Use 'minikube start -p <name>' to create a new cluster, or 'minikube delete' to delete this one.
ğŸ”„  Starting existing virtualbox VM for "minikube" ...
âŒ›  Waiting for the host to be provisioned ...
ğŸ³  Preparing Kubernetes v1.16.2 on Docker '18.09.9' ...
ğŸ”„  Relaunching Kubernetes using kubeadm ...
âŒ›  Waiting for: apiserver
ğŸ„  Done! kubectl is now configured to use "minikube"
```

## Kubernetes ë””í”Œë¡œì´ë¨¼íŠ¸ ìƒì„±

kubectl ëª…ë ¹ì–´ë¥¼ ì´ìš©í•˜ì—¬ echoserver ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í•˜ì—¬ Kubernetes Deploymentë¥¼ ìƒì„±í•©ë‹ˆë‹¤. ì„œë¹„ìŠ¤ ë””í”Œë¡œì´ë¨¼íŠ¸ ì´ë¦„ì€ hello-minikube ìœ¼ë¡œ ì„¤ì •í•˜, --port ì˜µì…˜ì„ ì‚¬ìš©í•˜ì—¬ 8080 í¬íŠ¸ë²ˆí˜¸ë¡œ ì™¸ë¶€ì— ë…¸ì¶œí•©ë‹ˆë‹¤.

```text
kubectl run hello-minikube --image=k8s.gcr.io/echoserver:1.10 --port=8080
```

## ì„œë¹„ìŠ¤ ë…¸ì¶œ

hello-minikube ë””í”Œë¡œì´ë¨¼íŠ¸ì— ì™¸ë¶€ì—ì„œ ì—‘ì„¸ìŠ¤í•˜ê¸° ìœ„í•´ NodePort íƒ€ì…ìœ¼ë¡œ expose í•©ë‹ˆë‹¤.

```text
kubectl expose deployment hello-minikube --type=NodePort
```

## ì„œë¹„ìŠ¤ êµ¬ë™ í™•ì¸

hello-minikube Podê°€ ì‹¤í–‰ë˜ê³  ìˆëŠ” ì¤‘ì´ê³ , Podê°€ ì •ìƒì ìœ¼ë¡œ ì‹¤í–‰ë˜ì–´ êµ¬ë™ì¤‘ì¸ì§€ í™•ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤. ì•„ë˜ì™€ ê°™ì´ hello-minikybe Pod 2ê°œê°€ 12ë¶„ ì „ì— ì‹¤í–‰ë˜ì—ˆê³ , ëª¨ë‘ ì‹¤í–‰ì¤‘ì¸ ìƒíƒœë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. STTUS=ContainerCreating ìƒíƒœë¡œ ë³´ì¼ ê²½ìš°, ì•„ì§ Podê°€ ìƒì„±ì¤‘ì„ì„ ë‚˜íƒ€ë‚´ëŠ” ê²ƒì´ê³  ì ì‹œ í›„ì— Running ìƒíƒœë¡œ ë³€í•˜ê²Œ ë©ë‹ˆë‹¤.

```text
$ kubectl get pod
NAME                              READY   STATUS    RESTARTS   AGE
hello-minikube-56cdb79778-64ffl   2/2     Running   0          12m
```

## ì„œë¹„ìŠ¤ ìƒì„¸ì •ë³´ í™•ì¸

hello-minikube ì„œë¹„ìŠ¤ì— ì ‘ì†í•˜ê¸° ìœ„í•œ url ì •ë³´ë¥¼ ì–»ìŠµë‹ˆë‹¤. Node IP\(192.168.99.100\)ì™€ ë…¸ì¶œëœ ì™¸ë¶€ ì„œë¹„ìŠ¤ í¬íŠ¸\(31611\)ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì €ë¥¼ ë„ìš´í›„ [http://192.168.64.2:31546](http://192.168.64.2:31546) URLë¡œ ì ‘ì†í•˜ë©´ echoserver ì„œë²„ë¡œë¶€í„° ë°›ì€ ì‘ë‹µë©”ì‹œì§€ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```text
minikube service hello-minikube --url

http://192.168.99.100:31611
```

ë˜í•œ curl ëª…ë ¹ì–´ë¥¼ ì´ìš©í•˜ì—¬ POST ë©”ì‹œì§€ bodyì— 'hello istio' ëª…ë ¹ì–´ë¥¼ ì „ë‹¬í•˜ì—¬ ì‘ë‹µë©”ì‹œë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```text
curl -L -v -d 'hello istio' http://192.168.99.100:31611

* Rebuilt URL to: http://192.168.99.100:31611/
*   Trying 192.168.99.100...
* TCP_NODELAY set
* Connected to 192.168.99.100 (192.168.99.100) port 31611 (#0)
> POST / HTTP/1.1
> Host: 192.168.99.100:31611
> User-Agent: curl/7.54.0
> Accept: */*
> Content-Length: 11
> Content-Type: application/x-www-form-urlencoded
>
* upload completely sent off: 11 out of 11 bytes
< HTTP/1.1 200 OK
< Date: Sun, 23 Feb 2020 15:06:19 GMT
< Content-Type: text/plain
< Transfer-Encoding: chunked
< Connection: keep-alive
< Server: echoserver
<


Hostname: hello-minikube-647f9746bc-rq6n4

Pod Information:
    -no pod information available-

Server values:
    server_version=nginx: 1.13.3 - lua: 10008

Request Information:
    client_address=172.17.0.1
    method=POST
    real path=/
    query=
    request_version=1.1
    request_scheme=http
    request_uri=http://192.168.99.100:8080/

Request Headers:
    accept=*/*
    content-length=11
    content-type=application/x-www-form-urlencoded
    host=192.168.99.100:31611
    user-agent=curl/7.54.0

Request Body:
hello istio
```

hello-minikube ì„œë¹„ìŠ¤ì— ëŒ€í•œ ìì„¸í•œ ì •ë³´ëŠ” minikube dashboard ê¸°ëŠ¥ì„ í†µí•´ì„œë„ í™•ì¸ ê°€ëŠ¥í•©ë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ Minikube Dashboard ê¸°ëŠ¥ì„ í™œì„±í™” ì‘ì—…ì´ ì‚¬ì „ì— í•„ìš”í•©ë‹ˆë‹¤.

### Minikube addon list í™•ì¸

```text
minikube addons list

- addon-manager: enabled
- dashboard: enabled
- default-storageclass: enabled
- efk: disabled
- freshpod: disabled
- gvisor: disabled
- heapster: disabled
- helm-tiller: disabled
- ingress: disabled
- ingress-dns: disabled
- logviewer: disabled
- metrics-server: disabled
- nvidia-driver-installer: disabled
- nvidia-gpu-device-plugin: disabled
- registry: disabled
- registry-creds: disabled
- storage-provisioner: enabled
- storage-provisioner-gluster: disabled
```

### Minikube Dashboard í™œì„±í™”

```text
minikube addons enable dashboard

âœ…  dashboard was successfully enabled
```

### Minikube Dashboard ì‹¤í–‰

minikube dashboard ëª…ë ¹ì–´ë¥¼ í†µí•´ ì‹¤í–‰ ê°€ëŠ¥í•˜ê³ , ë¸Œë¼ìš°ì € ì°½ì´ ëœ¨ë©´ì„œ ëŒ€ì‹œë³´ë“œ ì›¹ UI í™•ì¸ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.

```text
minikube dashboard

ğŸ¤”  Verifying dashboard health ...
ğŸš€  Launching proxy ...
ğŸ¤”  Verifying proxy health ...
ğŸ‰  Opening http://127.0.0.1:56441/api/v1/namespaces/kubernetes-dashboard/services/http:kubernetes-dashboard:/proxy/ in your default browser...
```

Dashboard ë¸Œë¼ìš°ì € ì™¼ìª½ ë©”ì¸ ë©”ë‰´ì—ì„œ ì›Œí¬ë¡œë“œ-&gt;íŒŒë“œ\(Pod\)ë¥¼ í´ë¦­í•˜ë©´ ë°©ê¸ˆ ì‹¤í–‰í•œ hello-minikube-647f9746bc-rq6n4 ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. Podë¥¼ í´ë¦­í•˜ë©´ ì•„ë˜ ê·¸ë¦¼ê³¼ ê°™ì´ ìƒì„¸í•œ ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![Dashboard](https://github.com/istiokrsg/istio_book_kr/tree/4513dd0b5f9ec9c5870a2d0ea8387d1aa2caaf38/.gitbook/assets/image-10.png)

### echoserver ë©”ì‹œì§€ í”Œë¡œìš°

ë¸Œë¼ìš°ì €ì—ì„œ echoserver\([http://192.168.99.100:31611\](http://192.168.99.100:31611%29\) ê¹Œì§€ ë©”ì‹œì§€ê°€ ì „ë‹¬ë˜ëŠ” ê²½ë¡œë¥¼ ë¶„ì„í•´ë³´ë©´ ì•„ë˜ ê·¸ë¦¼ì²˜ëŸ¼ ë„ì‹í™” í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. Node IPì˜ ê²½ìš° Virtualbox VM ìœ¼ë¡œ ì‹¤í–‰ë˜ì—ˆê³ , ì‚¬ì„¤ IPì´ê¸° ë•Œë¬¸ì— ì™¸ë¶€ Internet ë§ì„ í†µí•´ì„œ ì ‘ì†ì„ ë¶ˆê°€ëŠ¥ í•©ë‹ˆë‹¤. ë”°ë¼ì„œ Host PC ë¸Œë¼ìš°ì € í†µí•´ì„œë§Œ ì ‘ê·¼ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.

![echoserver-node-port](https://github.com/istiokrsg/istio_book_kr/tree/dff5a54ab2a1ab044559fecf95f241ace042dba0/.gitbook/assets/echoserver-nodeport-archi.png)

